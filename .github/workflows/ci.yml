# JOB 5: DEPLOYMENT ARTIFACT
  # This job creates a .zip file and uploads it as an artifact.
  # It does NOT commit anything to your repository.
  cd-pipeline:
    runs-on: ubuntu-latest
    needs: [build, lint, test-and-coverage, security] # Waits for all CI jobs
    if: github.event_name == 'push' # Only on push
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Download all CI Artifacts
        uses: actions/download-artifact@v4
        # This downloads all reports from other jobs into this runner
      
      - name: Create Deployment Artifact (.zip)
        run: |
          mkdir -p deployment/reports # Create folder for reports
          
          # Move reports into the deployment folder
          mv lint-report/lint-report.json deployment/reports/
          mv coverage-report deployment/reports/coverage-report
          mv security-report/security-report.json deployment/reports/
          
          # Copy the entire client folder (which has public/ and src/ inside)
          cp -r client deployment/client
          
          # Copy the tests folder
          cp -r tests deployment/tests
          
          # Copy all the important root-level files
          cp .gitignore deployment/ || true
          cp eslint.config.js deployment/ || true
          cp jest.config.js deployment/ || true
          cp package-lock.json deployment/ || true
          cp package.json deployment/ || true
          cp README.md deployment/ || true
          
          # Create the final zip
          zip -r deployment-package.zip deployment
      
      # This step uploads the zip to the Actions page. It does NOT commit to the repo.
      - name: Upload Final Deployment Artifact
        uses: actions/upload-artifact@v4
        with:
          name: deployment-package
          path: deployment-package.zip